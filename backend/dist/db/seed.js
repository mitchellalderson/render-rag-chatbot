"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.seedDatabase = seedDatabase;
const config_1 = require("./config");
const dotenv_1 = __importDefault(require("dotenv"));
// Load environment variables
dotenv_1.default.config();
// Sample documents for seeding (without embeddings - these should be generated by your embedding model)
const sampleDocuments = [
    {
        content: 'Machine learning is a subset of artificial intelligence that focuses on the development of algorithms that can learn from and make predictions on data.',
        metadata: { category: 'AI', topic: 'Machine Learning' }
    },
    {
        content: 'Deep learning is a type of machine learning based on artificial neural networks with representation learning.',
        metadata: { category: 'AI', topic: 'Deep Learning' }
    },
    {
        content: 'Natural Language Processing (NLP) is a branch of AI that helps computers understand, interpret and manipulate human language.',
        metadata: { category: 'AI', topic: 'NLP' }
    }
];
async function seedDatabase() {
    console.log('ðŸŒ± Starting database seeding...\n');
    const connected = await (0, config_1.testConnection)();
    if (!connected) {
        console.error('Failed to connect to database. Please check your configuration.');
        process.exit(1);
    }
    const client = await config_1.pool.connect();
    try {
        await client.query('BEGIN');
        // Check if documents already exist
        const { rows } = await client.query('SELECT COUNT(*) FROM documents');
        const count = parseInt(rows[0].count, 10);
        if (count > 0) {
            console.log(`âš ï¸  Database already contains ${count} document(s). Skipping seed.`);
            console.log('   To re-seed, manually truncate the tables first.');
            await client.query('ROLLBACK');
            return;
        }
        // Insert sample documents (without embeddings)
        console.log('ðŸ“ Inserting sample documents...');
        for (const doc of sampleDocuments) {
            await client.query('INSERT INTO documents (content, metadata) VALUES ($1, $2)', [doc.content, doc.metadata]);
        }
        await client.query('COMMIT');
        console.log(`âœ… Successfully seeded ${sampleDocuments.length} documents!`);
        console.log('\nâš ï¸  Note: Documents do not have embeddings yet.');
        console.log('   You will need to generate embeddings using your chosen AI model.');
    }
    catch (error) {
        await client.query('ROLLBACK');
        console.error('âŒ Seeding failed:', error);
        throw error;
    }
    finally {
        client.release();
        await config_1.pool.end();
    }
}
if (require.main === module) {
    seedDatabase()
        .then(() => process.exit(0))
        .catch((error) => {
        console.error(error);
        process.exit(1);
    });
}
//# sourceMappingURL=seed.js.map